<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>L'Atelier du Bowl – Personnalisation Poké XL</title>

<!-- Police soignée -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --brand:#ff3a3a; --brand-2:#ff7a59;
    --bg:#fff8f5; --ink:#232323; --panel:#ffffff; --muted:#6b7280;
    --ring:rgba(255,58,58,.25); --shadow:0 10px 30px rgba(0,0,0,.08);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}

  /* Header */
  header{
    color:#fff;
    background:
      radial-gradient(1100px 380px at 50% -60%, rgba(255,255,255,.22), transparent),
      linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
    padding:18px 12px;
    box-shadow:var(--shadow);
  }
  header .wrap{
    max-width:1100px;margin:0 auto;
    display:flex;gap:1rem;align-items:center;justify-content:space-between;
  }
  header a{color:#fff;text-decoration:none;font-weight:800}
  header a:hover{opacity:.9}
  header strong{font-size:clamp(16px,2.5vw,20px);letter-spacing:.2px}

  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  .breadcrumb{
    color:#374151;background:#fff;border:1px solid #f1f1f1;border-radius:999px;
    display:inline-flex;gap:.5rem;align-items:center;padding:.4rem .75rem;
    box-shadow:0 6px 18px rgba(0,0,0,.04);font-weight:600
  }
  .breadcrumb a{color:#374151;text-decoration:none}
  .breadcrumb a:hover{text-decoration:underline}

  /* Sections */
  .section{
    margin:16px 0;background:var(--panel);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:18px
  }
  .section h2{
    margin:.2rem 0 .8rem;color:var(--brand);font-size:clamp(18px,2.6vw,24px)
  }
  .section h2::after{
    content:"";display:block;width:48px;height:3px;margin:8px 0 0;border-radius:999px;
    background:linear-gradient(90deg,var(--brand),var(--brand-2));
  }

  /* Grilles ingrédients */
  .ingredients-grid{
    display:grid;gap:.9rem;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))
  }
  .ingredients-grid label{
    display:flex;flex-direction:column;align-items:center;gap:.55rem;
    border:1px solid #eee;background:#fff;border-radius:16px;padding:.9rem;cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.05);
    transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease
  }
  .ingredients-grid label:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(0,0,0,.08)}
  .ingredients-grid img{width:96px;height:96px;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.06))}
  .ingredients-grid input{margin-top:.2rem}

  /* Sélection visuelle */
  .ingredients-grid label.selected,
  .ingredients-grid label:has(input:checked){
    border-color:#ffc7c7;background:#fff8f7;
    box-shadow:0 10px 26px rgba(255,58,58,.12)
  }

  .counter{
    display:inline-block;background:#fff;border:1px solid #f1f1f1;border-radius:999px;
    padding:.3rem .65rem;font-size:.92rem;color:#374151;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,.04)
  }
  .muted{color:var(--muted)}
  .actions{display:flex;gap:.8rem;flex-wrap:wrap;justify-content:flex-end;margin-top:1rem}

  .btn{
    background:#fff;color:var(--brand);border:none;border-radius:12px;padding:.9rem 1.2rem;font-weight:800;cursor:pointer;
    box-shadow:0 10px 26px var(--ring);border:1px solid #ffd2d2;transition:transform .15s ease, filter .15s ease
  }
  .btn:hover{transform:translateY(-1px);filter:brightness(.98)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}

  .note{
    background:#fff3f3;border:1px solid #ffd2d2;color:#b60000;
    padding:.6rem .8rem;border-radius:12px;margin:.4rem 0;font-weight:600
  }

  /* FAB panier */
  .fab-cart{
    position:fixed;right:18px;bottom:18px;z-index:9999;
    background:linear-gradient(90deg,var(--brand),var(--brand-2));
    border:none;color:#fff;width:62px;height:62px;border-radius:50%;
    box-shadow:0 8px 24px rgba(255,58,58,.35);
    display:flex;align-items:center;justify-content:center;cursor:pointer
  }
  .fab-cart img{width:30px;height:30px;filter:invert(1) brightness(9)}
  .fab-cart .badge{
    position:absolute;top:6px;right:6px;background:#fff;color:var(--brand);
    font-weight:800;font-size:.82rem;border-radius:999px;padding:2px 6px;box-shadow:0 2px 6px rgba(0,0,0,.25)
  }
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
  .badge.pulse{animation:pulse .4s ease}

  /* Accessibilité */
  :focus-visible{outline:3px solid var(--brand-2);outline-offset:2px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div><a href="carte.html">← Retour à la carte</a></div>
    <strong>Compose ton Poké XL</strong>
    <a href="panier.html">Voir le panier</a>
  </div>
</header>

<main class="wrap">
  <div class="breadcrumb"><a href="carte.html">Carte</a> › Personnalisation Poké XL</div>

  <!-- Base -->
  <div class="section">
    <h2>Base</h2>
    <div class="ingredients-grid">
      <label><input type="radio" name="base" value="riz" required><img src="images/riz.png" alt="Riz"><span>Riz</span></label>
      <label><input type="radio" name="base" value="riz noir"><img src="images/riznoir.png" alt="Riz noir"><span>Riz Noir</span></label>
      <label><input type="radio" name="base" value="duo riz"><img src="images/duoderiz.png" alt="Duo de riz"><span>Duo de Riz</span></label>
      <label><input type="radio" name="base" value="salade"><img src="images/salade.png" alt="Salade"><span>Salade</span></label>
    </div>
  </div>

  <!-- Ingrédients -->
  <div class="section">
    <h2>Ingrédients (3 à 6)</h2>
    <div class="counter" id="ingCounter"></div>
    <div class="ingredients-grid" id="ingredients">
      <label><input type="checkbox" value="avocat"><img src="images/avocat.png" alt="Avocat"><span>Avocat</span></label>
      <label><input type="checkbox" value="betterave"><img src="images/betterave.png" alt="Betterave"><span>Betterave</span></label>
      <label><input type="checkbox" value="carotte"><img src="images/carotte.png" alt="Carotte"><span>Carotte</span></label>
      <label><input type="checkbox" value="champignon"><img src="images/champignon.png" alt="Champignon"><span>Champignon</span></label>
      <label><input type="checkbox" value="chouxrouge"><img src="images/chouxrouge.png" alt="Choux rouge"><span>Choux rouge</span></label>
      <label><input type="checkbox" value="concombre"><img src="images/concombre.png" alt="Concombre"><span>Concombre</span></label>
      <label><input type="checkbox" value="edamame"><img src="images/edamame.png" alt="Edamame"><span>Edamame</span></label>
      <label><input type="checkbox" value="feta"><img src="images/feta.png" alt="Feta"><span>Feta</span></label>
      <label><input type="checkbox" value="grenade"><img src="images/grenade.png" alt="Grenade"><span>Grenade</span></label>
      <label><input type="checkbox" value="mais"><img src="images/mais.png" alt="Maïs"><span>Maïs</span></label>
      <label><input type="checkbox" value="mangue"><img src="images/mangue.png" alt="Mangue"><span>Mangue</span></label>
      <label><input type="checkbox" value="mozzarella"><img src="images/mozzarella.png" alt="Mozzarella"><span>Mozzarella</span></label>
      <label><input type="checkbox" value="oignonrouge"><img src="images/oignonrouge.png" alt="Oignon rouge"><span>Oignon rouge</span></label>
      <label><input type="checkbox" value="poivrons"><img src="images/poivrons.png" alt="Poivrons"><span>Poivrons</span></label>
      <label><input type="checkbox" value="radis"><img src="images/radis.png" alt="Radis"><span>Radis</span></label>
      <label><input type="checkbox" value="tomates"><img src="images/tomates.png" alt="Tomates"><span>Tomates</span></label>
      <label><input type="checkbox" value="wakame"><img src="images/wakame.png" alt="Wakame"><span>Wakame</span></label>
    </div>
    <div class="note" id="ingHint" style="display:none"></div>
  </div>

  <!-- Protéines -->
  <div class="section">
    <h2>Protéines (1 à 2)</h2>
    <div class="counter" id="protCounter"></div>
    <div class="ingredients-grid" id="proteines">
      <label><input type="checkbox" value="saumon"><img src="images/saumon.png" alt="Saumon"><span>Saumon</span></label>
      <label><input type="checkbox" value="poulet"><img src="images/poulet.png" alt="Poulet"><span>Poulet</span></label>
      <label><input type="checkbox" value="oeufs"><img src="images/oeufs.png" alt="Œufs"><span>Œufs</span></label>
      <label><input type="checkbox" value="tofu"><img src="images/tofu.png" alt="Tofu"><span>Tofu</span></label>
      <label><input type="checkbox" value="thon"><img src="images/thon.png" alt="Thon"><span>Thon</span></label>
    </div>
  </div>

  <!-- Sauce -->
  <div class="section">
    <h2>Sauce</h2>
    <div class="ingredients-grid" id="sauces">
      <label><input type="radio" name="sauce" value="soja sucrée" required><img src="images/soja.png" alt="Soja sucrée"><span>Soja sucrée</span></label>
      <label><input type="radio" name="sauce" value="soja salée"><img src="images/soja.png" alt="Soja salée"><span>Soja salée</span></label>
      <label><input type="radio" name="sauce" value="césar"><img src="images/césar.png" alt="César"><span>César</span></label>
      <label><input type="radio" name="sauce" value="moutarde miel"><img src="images/miel_moutarde.png" alt="Moutarde miel"><span>Moutarde miel</span></label>
      <label><input type="radio" name="sauce" value="curry mangue"><img src="images/curry_mango.png" alt="Curry mangue"><span>Curry mangue</span></label>
      <label><input type="radio" name="sauce" value="mayo épicée"><img src="images/mayo_epicee.png" alt="Mayo épicée"><span>Mayo épicée</span></label>
      <label><input type="radio" name="sauce" value="passion"><img src="images/passion.png" alt="Passion"><span>Passion</span></label>
      <label><input type="radio" name="sauce" value="balsamique"><img src="images/balsamique.png" alt="Balsamique"><span>Balsamique</span></label>
    </div>
  </div>

  <!-- Toppings -->
  <div class="section">
    <h2>Toppings (optionnels, 2 max)</h2>
    <div class="counter" id="topCounter"></div>
    <div class="ingredients-grid" id="toppings">
      <label><input type="checkbox" value="sésame"><img src="images/sésame.png" alt="Sésame"><span>Sésame</span></label>
      <label><input type="checkbox" value="pavot"><img src="images/pavot.png" alt="Pavot"><span>Pavot</span></label>
      <label><input type="checkbox" value="cacahuete"><img src="images/cacahuètes.png" alt="Cacahuète"><span>Cacahuète</span></label>
      <label><input type="checkbox" value="croutons"><img src="images/croutons.png" alt="Croûtons"><span>Croûtons</span></label>
      <label><input type="checkbox" value="coriandre"><img src="images/coriandre.png" alt="Coriandre"><span>Coriandre</span></label>
      <label><input type="checkbox" value="oignons frits"><img src="images/oignons_frits.png" alt="Oignons frits"><span>Oignons frits</span></label>
    </div>
  </div>

  <!-- Action -->
  <div class="section actions">
    <button class="btn" id="addToCart" disabled>Ajouter au panier (14,5 €)</button>
  </div>
</main>

<button class="fab-cart" title="Voir le panier" onclick="window.location.href='panier.html'">
  <img src="images/caddie.png" alt="Panier">
  <div class="badge" id="cartBadge">0</div>
</button>

<script>
  // === Paramètres ===
  const CART_KEY = 'ce-panier';
  const BASE_PRICE = 14.5;        // prix Poké XL
  const INCLUDED_ING = 6;         // ingrédients inclus
  const EXTRA_ING_PRICE = 0.80;   // prix par ingrédient supplémentaire
  const ING_MIN = 3;              // minimum requis
  const PROT_MIN = 1, PROT_MAX = 2;
  const TOP_MAX  = 2;

  // --- stockage & badge ---
  if (!localStorage.getItem(CART_KEY)) localStorage.setItem(CART_KEY, JSON.stringify([]));
  function updateBadge() {
    const cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    const badge = document.getElementById('cartBadge');
    if (badge) badge.textContent = cart.length;
  }

  // Surbrillance visuelle (.selected) – compat anciens navigateurs
  function refreshSelectedClasses(scope){
    const root = scope || document;
    root.querySelectorAll('.ingredients-grid').forEach(grid=>{
      grid.querySelectorAll('label').forEach(lb=>lb.classList.remove('selected'));
      grid.querySelectorAll('input:checked').forEach(inp=>{
        const lb = inp.closest('label'); if(lb) lb.classList.add('selected');
      });
    });
  }

  const fmt = n => n.toFixed(2).replace('.', ',') + ' €';

  // --- validation + compteurs + bouton (prix dynamique) ---
  function validate() {
    const ingSel = document.querySelectorAll('#ingredients input:checked').length;
    const protSel = document.querySelectorAll('#proteines input:checked').length;
    const topSel  = document.querySelectorAll('#toppings  input:checked').length;
    const baseOk  = !!document.querySelector('input[name="base"]:checked');
    const sauceOk = !!document.querySelector('input[name="sauce"]:checked');

    // Extras
    const extraCount = Math.max(0, ingSel - INCLUDED_ING);
    const extraCost  = extraCount * EXTRA_ING_PRICE;
    const total      = BASE_PRICE + extraCost;

    // Compteurs
    const ingCounter  = document.getElementById('ingCounter');
    const protCounter = document.getElementById('protCounter');
    const topCounter  = document.getElementById('topCounter');

    if (ingCounter) {
      ingCounter.textContent =
        `Ingrédients : ${ingSel} (4 minimum, ${INCLUDED_ING} maximum, +0,80€ par ingrédients supplémentaires`+
        (extraCount>0 ? ` • +${extraCount} extra = +${fmt(extraCost)}` : '') + ' )';
    }
    if (protCounter) protCounter.textContent = `Protéines : ${protSel}/${PROT_MAX} (min ${PROT_MIN})`;
    if (topCounter)  topCounter.textContent  = `Toppings : ${topSel}/${TOP_MAX}`;

    // Hint si < min ingrédients
    const ingHint = document.getElementById('ingHint');
    if (ingHint) {
      if (ingSel < ING_MIN) {
        ingHint.style.display = 'block';
        ingHint.textContent = `Choisis encore ${ING_MIN - ingSel} ingrédient(s) pour atteindre le minimum.`;
      } else {
        ingHint.style.display = 'none';
      }
    }

    // Règles : min 3 ingrédients (pas de plafond), 1–2 protéines, toppings ≤ 2, base + sauce
    const validIngr = ingSel >= ING_MIN;
    const validProt = (protSel >= PROT_MIN && protSel <= PROT_MAX);
    const validTop  = (topSel  <= TOP_MAX);

    const btn = document.getElementById('addToCart');
    const enabled = (validIngr && validProt && baseOk && sauceOk && validTop);
    btn.disabled = !enabled;
    btn.textContent = enabled ? `Ajouter au panier (${fmt(total)})` : `Ajouter au panier (${fmt(BASE_PRICE)})`;
  }

  // --- Limites d’activation ---
  // Ingrédients : jamais désactivés (on autorise au-delà de 6)
  // Protéines & toppings : plafonds respectés
  function enforceLimits() {
    document.querySelectorAll('#ingredients input[type="checkbox"]').forEach(i => i.disabled = false);

    const protInputs = Array.from(document.querySelectorAll('#proteines input[type="checkbox"]'));
    const topInputs  = Array.from(document.querySelectorAll('#toppings  input[type="checkbox"]'));
    const protSel = protInputs.filter(i => i.checked).length;
    const topSel  = topInputs .filter(i => i.checked).length;

    protInputs.forEach(i => { i.disabled = (!i.checked && protSel >= PROT_MAX); });
    topInputs .forEach(i => { i.disabled = (!i.checked && topSel  >= TOP_MAX ); });
  }

  // --- listeners ---
  document.querySelectorAll('#ingredients input, #proteines input, #toppings input, input[name="base"], input[name="sauce"]').forEach(el => {
    el.addEventListener('change', () => { enforceLimits(); validate(); refreshSelectedClasses(); });
  });

  // --- Ajouter au panier ---
  const btnAdd = document.getElementById('addToCart');
  btnAdd.addEventListener('click', () => {
    const ingSel = document.querySelectorAll('#ingredients input:checked').length;
    const extraCount = Math.max(0, ingSel - INCLUDED_ING);
    const extraCost  = +(extraCount * EXTRA_ING_PRICE).toFixed(2);
    const total      = +(BASE_PRICE + extraCost).toFixed(2);

    const item = {
      type: 'poke',
      size: 'XL',
      base: document.querySelector('input[name="base"]:checked').value,
      ingredients: [...document.querySelectorAll('#ingredients input:checked')].map(x => x.value),
      proteines:   [...document.querySelectorAll('#proteines input:checked')].map(x => x.value),
      sauce: document.querySelector('input[name="sauce"]:checked').value,
      toppings:     [...document.querySelectorAll('#toppings  input:checked')].map(x => x.value),
      price: total,                                   // ✅ prix avec extras
      extras: { extra_ingredients: extraCount, extra_cost: extraCost },
      qty: 1,
      ts: Date.now()
    };

    const cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    cart.push(item);
    localStorage.setItem(CART_KEY, JSON.stringify(cart));

    updateBadge();
    const badge = document.getElementById('cartBadge');
    if (badge) { badge.classList.add('pulse'); setTimeout(()=> badge.classList.remove('pulse'), 400); }

    btnAdd.disabled = true;
    setTimeout(() => { window.location.href = 'carte.html'; }, 450);
  });

  // --- init ---
  enforceLimits();
  validate();
  updateBadge();
  refreshSelectedClasses();
</script>


</body>
</html>
