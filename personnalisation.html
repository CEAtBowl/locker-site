<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>L'Atelier du Bowl – Personnalisation Menu</title>

<!-- Police soignée -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
  :root{
    --brand:#ff3a3a; --brand-2:#ff7a59;
    --bg:#fff8f5; --ink:#232323; --panel:#ffffff; --muted:#6b7280;
    --ring:rgba(255,58,58,.25); --shadow:0 10px 30px rgba(0,0,0,.08);
    --radius:18px;
  }
  *{box-sizing:border-box}
  html{scroll-behavior:smooth}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}

  /* Header */
  header{
    color:#fff;
    background:
      radial-gradient(1100px 380px at 50% -60%, rgba(255,255,255,.22), transparent),
      linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
    padding:18px 12px;
    box-shadow:var(--shadow);
  }
  header .wrap{
    max-width:1100px;margin:0 auto;
    display:flex;gap:1rem;align-items:center;justify-content:space-between;
  }
  header a{color:#fff;text-decoration:none;font-weight:800}
  header a:hover{opacity:.9}
  header strong{font-size:clamp(16px,2.5vw,20px);letter-spacing:.2px}

  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  .breadcrumb{
    color:#374151;background:#fff;border:1px solid #f1f1f1;border-radius:999px;
    display:inline-flex;gap:.5rem;align-items:center;padding:.4rem .75rem;
    box-shadow:0 6px 18px rgba(0,0,0,.04);font-weight:600
  }
  .breadcrumb a{color:#374151;text-decoration:none}
  .breadcrumb a:hover{text-decoration:underline}

  /* Sections */
  .section{
    margin:16px 0;background:var(--panel);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:18px
  }
  .section h2{
    margin:.2rem 0 .8rem;color:var(--brand);font-size:clamp(18px,2.6vw,24px)
  }
  .section h2::after{
    content:"";display:block;width:48px;height:3px;margin:8px 0 0;border-radius:999px;
    background:linear-gradient(90deg,var(--brand),var(--brand-2));
  }

  .grid{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
  .choice{display:flex;gap:.6rem;flex-wrap:wrap}

  /* Pills tailles */
  .pill{
    padding:.6rem 1rem;border:1px solid #ffd2d2;background:#fff;border-radius:999px;
    cursor:pointer;font-weight:800;color:var(--brand);
    box-shadow:0 6px 18px rgba(255,58,58,.06);
    transition:transform .15s ease, background .15s ease, box-shadow .15s ease
  }
  .pill:hover{transform:translateY(-1px);background:#fff7f6}
  .pill input{display:none}
  .pill.active{background:#fff0ee;box-shadow:0 10px 26px rgba(255,58,58,.12)}

  /* Grilles ingrédients */
  .ingredients-grid{
    display:grid;gap:.9rem;grid-template-columns:repeat(auto-fit,minmax(150px,1fr))
  }
  .ingredients-grid label{
    display:flex;flex-direction:column;align-items:center;gap:.55rem;
    border:1px solid #eee;background:#fff;border-radius:16px;padding:.9rem;cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,.05);
    transition:transform .15s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease
  }
  .ingredients-grid label:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(0,0,0,.08)}
  .ingredients-grid img{width:96px;height:96px;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.06))}
  .ingredients-grid input{margin-top:.2rem}

  /* État sélectionné (via JS .selected + fallback :has pour navigateurs modernes) */
  .ingredients-grid label.selected,
  .ingredients-grid label:has(input:checked){
    border-color:#ffc7c7;background:#fff8f7;
    box-shadow:0 10px 26px rgba(255,58,58,.12)
  }

  .counter{
    display:inline-block;background:#fff;border:1px solid #f1f1f1;border-radius:999px;
    padding:.3rem .65rem;font-size:.92rem;color:#374151;font-weight:700;box-shadow:0 4px 12px rgba(0,0,0,.04)
  }
  .row{display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
  .muted{color:var(--muted)}

  .actions{display:flex;gap:.8rem;flex-wrap:wrap;justify-content:flex-end;margin-top:1rem}

  .btn{
    background:#fff;color:var(--brand);border:none;border-radius:12px;padding:.9rem 1.2rem;font-weight:800;cursor:pointer;
    box-shadow:0 10px 26px var(--ring);border:1px solid #ffd2d2;transition:transform .15s ease, filter .15s ease
  }
  .btn:hover{transform:translateY(-1px);filter:brightness(.98)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}

  .note{
    background:#fff3f3;border:1px solid #ffd2d2;color:#b60000;
    padding:.6rem .8rem;border-radius:12px;margin:.4rem 0;font-weight:600
  }

  /* FAB panier */
  .fab-cart{
    position:fixed;right:18px;bottom:18px;z-index:9999;
    background:linear-gradient(90deg,var(--brand),var(--brand-2));
    border:none;color:#fff;width:62px;height:62px;border-radius:50%;
    box-shadow:0 8px 24px rgba(255,58,58,.35);
    display:flex;align-items:center;justify-content:center;cursor:pointer
  }
  .fab-cart img{width:30px;height:30px;filter:invert(1) brightness(9)}
  .fab-cart .badge{
    position:absolute;top:6px;right:6px;background:#fff;color:var(--brand);
    font-weight:800;font-size:.82rem;border-radius:999px;padding:2px 6px;box-shadow:0 2px 6px rgba(0,0,0,.25)
  }
  @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.25)}100%{transform:scale(1)}}
  .badge.pulse{animation:pulse .4s ease}
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div><a href="carte.html">← Retour à la carte</a></div>
    <strong>Compose ton Menu : Poké + Smoothie Bowl</strong>
    <a href="panier.html">Voir le panier</a>
  </div>
</header>

<main class="wrap">
  <div class="breadcrumb"><a href="carte.html">Carte</a> › Personnalisation du menu</div>

  <!-- Étape 1 : Taille -->
  <section class="section" id="etape-taille">
    <h2>1) Choisis la taille du Poké</h2>
    <div class="choice" id="sizeChoice">
      <label class="pill"><input type="radio" name="size" value="L" required>Poké L (3–5 ingrédients • 1 protéine • 2 toppings max)</label>
      <label class="pill"><input type="radio" name="size" value="XL">Poké XL (3–6 ingrédients • 1–2 protéines • 2 toppings max)</label>
    </div>
    <div class="counter" id="rulesNotice"></div>
  </section>

  <!-- Étape 2 : Base -->
  <section class="section">
    <h2>2) Ta base</h2>
    <label class="muted">1 choix requis</label>
    <div class="ingredients-grid" id="base">
      <label><input type="radio" name="base" value="riz" required><img src="images/riz.png" alt="Riz"><span>Riz</span></label>
      <label><input type="radio" name="base" value="riz noir"><img src="images/riznoir.png" alt="Riz Noir"><span>Riz Noir</span></label>
      <label><input type="radio" name="base" value="duo de riz"><img src="images/duoderiz.png" alt="Duo de riz"><span>Duo de riz</span></label>
      <label><input type="radio" name="base" value="salade"><img src="images/salade.png" alt="Salade"><span>Salade</span></label>
    </div>
  </section>

  <!-- Étape 3 : Ingrédients -->
  <section class="section">
    <h2>3) Tes ingrédients</h2>
    <div class="counter" id="ingCounter" aria-live="polite"></div>
    <div class="ingredients-grid" id="ingredients">
      <label><input type="checkbox" name="ingredients" value="avocat"><img src="images/avocat.png" alt="Avocat"><span>Avocat</span></label>
      <label><input type="checkbox" name="ingredients" value="betterave"><img src="images/betterave.png" alt="Betterave"><span>Betterave</span></label>
      <label><input type="checkbox" name="ingredients" value="carotte"><img src="images/carotte.png" alt="Carotte"><span>Carotte</span></label>
      <label><input type="checkbox" name="ingredients" value="champignon"><img src="images/champignon.png" alt="Champignon"><span>Champignon</span></label>
      <label><input type="checkbox" name="ingredients" value="chouxrouge"><img src="images/chouxrouge.png" alt="Choux rouge"><span>Choux rouge</span></label>
      <label><input type="checkbox" name="ingredients" value="concombre"><img src="images/concombre.png" alt="Concombre"><span>Concombre</span></label>
      <label><input type="checkbox" name="ingredients" value="edamame"><img src="images/edamame.png" alt="Edamame"><span>Edamame</span></label>
      <label><input type="checkbox" name="ingredients" value="feta"><img src="images/feta.png" alt="Feta"><span>Feta</span></label>
      <label><input type="checkbox" name="ingredients" value="grenade"><img src="images/grenade.png" alt="Grenade"><span>Grenade</span></label>
      <label><input type="checkbox" name="ingredients" value="mais"><img src="images/mais.png" alt="Maïs"><span>Maïs</span></label>
      <label><input type="checkbox" name="ingredients" value="mangue"><img src="images/mangue.png" alt="Mangue"><span>Mangue</span></label>
      <label><input type="checkbox" name="ingredients" value="mozzarella"><img src="images/mozzarella.png" alt="Mozzarella"><span>Mozzarella</span></label>
      <label><input type="checkbox" name="ingredients" value="oignonrouge"><img src="images/oignonrouge.png" alt="Oignon rouge"><span>Oignon rouge</span></label>
      <label><input type="checkbox" name="ingredients" value="poivrons"><img src="images/poivrons.png" alt="Poivrons"><span>Poivrons</span></label>
      <label><input type="checkbox" name="ingredients" value="radis"><img src="images/radis.png" alt="Radis"><span>Radis</span></label>
      <label><input type="checkbox" name="ingredients" value="tomates"><img src="images/tomates.png" alt="Tomates"><span>Tomates</span></label>
      <label><input type="checkbox" name="ingredients" value="wakame"><img src="images/wakame.png" alt="Wakame"><span>Wakame</span></label>
    </div>
    <div class="note" id="ingHint" style="display:none"></div>
  </section>

  <!-- Étape 4 : Protéines -->
  <section class="section">
    <h2>4) Ta/tes protéine(s)</h2>
    <div class="counter" id="protCounter" aria-live="polite"></div>
    <div class="ingredients-grid" id="protéines">
      <label><input type="checkbox" name="proteines" value="saumon"><img src="images/saumon.png" alt="Saumon"><span>Saumon</span></label>
      <label><input type="checkbox" name="proteines" value="poulet"><img src="images/poulet.png" alt="Poulet"><span>Poulet</span></label>
      <label><input type="checkbox" name="proteines" value="oeufs"><img src="images/oeufs.png" alt="Œufs"><span>Œufs</span></label>
      <label><input type="checkbox" name="proteines" value="tofu"><img src="images/tofu.png" alt="Tofu"><span>Tofu</span></label>
      <label><input type="checkbox" name="proteines" value="thon"><img src="images/thon.png" alt="Thon"><span>Thon</span></label>
    </div>
  </section>

  <!-- Étape 5 : Sauce -->
  <section class="section">
    <h2>5) Ta sauce</h2>
    <div class="ingredients-grid" id="sauces">
      <label><input type="radio" name="sauce" value="soja sucrée" required><img src="images/soja.png" alt="Soja sucrée"><span>Soja sucrée</span></label>
      <label><input type="radio" name="sauce" value="soja salée"><img src="images/soja.png" alt="Soja salée"><span>Soja salée</span></label>
      <label><input type="radio" name="sauce" value="césar"><img src="images/césar.png" alt="César"><span>César</span></label>
      <label><input type="radio" name="sauce" value="moutarde miel"><img src="images/miel_moutarde.png" alt="Moutarde miel"><span>Moutarde miel</span></label>
      <label><input type="radio" name="sauce" value="curry mangue"><img src="images/curry_mango.png" alt="Curry mangue"><span>Curry mangue</span></label>
      <label><input type="radio" name="sauce" value="mayo épicée"><img src="images/mayo_epicee.png" alt="Mayo épicée"><span>Mayo épicée</span></label>
      <label><input type="radio" name="sauce" value="passion"><img src="images/passion.png" alt="Passion"><span>Passion</span></label>
      <label><input type="radio" name="sauce" value="balsamique"><img src="images/balsamique.png" alt="Balsamique"><span>Balsamique</span></label>
    </div>
  </section>

  <!-- Étape 6 : Toppings -->
  <section class="section">
    <h2>6) Tes toppings (optionnel)</h2>
    <div class="counter" id="topCounter" aria-live="polite"></div>
    <div class="ingredients-grid" id="toppings">
      <label><input type="checkbox" name="toppings" value="sésame"><img src="images/sésame.png" alt="Sésame"><span>Sésame</span></label>
      <label><input type="checkbox" name="toppings" value="pavot"><img src="images/pavot.png" alt="Pavot"><span>Pavot</span></label>
      <label><input type="checkbox" name="toppings" value="cacahuete"><img src="images/cacahuètes.png" alt="Cacahuète"><span>Cacahuète</span></label>
      <label><input type="checkbox" name="toppings" value="croutons"><img src="images/croutons.png" alt="Croûtons"><span>Croûtons</span></label>
      <label><input type="checkbox" name="toppings" value="coriandre fraiche"><img src="images/coriandre.png" alt="Coriandre"><span>Coriandre</span></label>
      <label><input type="checkbox" name="toppings" value="oignons frits"><img src="images/oignons_frits.png" alt="Oignons frits"><span>Oignons frits</span></label>
    </div>
  </section>

  <!-- Étape 7 : Smoothie -->
  <section class="section">
    <h2>7) Ton Smoothie Bowl</h2>
    <label class="muted">1 choix requis</label>
    <div class="ingredients-grid">
      <label><input type="radio" name="smoothie" value="smoothie bowl kiwi" required><img src="images/smoothiekiwi.png" alt="Smoothie Bowl Kiwi"><span>Kiwi</span></label>
      <label><input type="radio" name="smoothie" value="smoothie bowl mangue"><img src="images/smoothiemangue.png" alt="Smoothie Bowl Mangue"><span>Mangue</span></label>
      <label><input type="radio" name="smoothie" value="smoothie bowl fruits rouges"><img src="images/smoothierouge.png" alt="Smoothie Bowl Fruits rouges"><span>Fruits rouges</span></label>
    </div>
  </section>

  <!-- Actions -->
  <section class="section">
    <div class="row">
      <div class="muted" id="review"></div>
      <div class="actions">
        <button class="btn" id="addToCart" disabled>Ajouter au panier</button>
      </div>
    </div>
  </section>

</main>

<button class="fab-cart" title="Voir le panier" onclick="window.location.href='panier.html'">
  <img src="images/caddie.png" alt="Panier">
  <div class="badge" id="cartBadge">0</div>
</button>

<script>
  const CART_KEY = 'ce-panier';
  if(!localStorage.getItem(CART_KEY)) localStorage.setItem(CART_KEY, JSON.stringify([]));

  // --- Badge panier ---
  function updateBadge(){
    const cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    const badge = document.getElementById('cartBadge');
    if (badge) badge.textContent = cart.length;
  }

  // ⚙️ Nouvelle règle: extras à +0,80€ au-delà des inclus
  const EXTRA_ING_PRICE = 0.80;
  const LIMITS = {
    L:  { ingMin:3, ingIncluded:5, protMin:1, protMax:1, topMax:2 },
    XL: { ingMin:3, ingIncluded:6, protMin:1, protMax:2, topMax:2 }
  };
  let current = null;

  // UI : pills actives
  document.querySelectorAll('.pill').forEach(p=>{
    p.addEventListener('click', ()=> {
      document.querySelectorAll('.pill').forEach(x=>x.classList.remove('active'));
      p.classList.add('active');
      p.querySelector('input').checked = true;
      updateRules();
      enforceLimits();
    });
  });

  function currentSize(){
    const s = document.querySelector('input[name="size"]:checked');
    return s ? s.value : null;
  }

  function updateRules(){
    const size = currentSize();
    const rules = document.getElementById('rulesNotice');
    current = size ? LIMITS[size] : null;
    if(size==='L'){
      rules.textContent = 'Règles L : 3 ingrédients minimum, 5 maximum, 1 protéine, 2 toppings max. Ingrédients supplémentaires : +0,80 € / ingrédient.';
    } else if(size==='XL'){
      rules.textContent = 'Règles XL : 3 ingrédients minimum, 6 maximum, 1 à 2 protéines, 2 toppings max. Ingrédients supplémentaires : +0,80 € / ingrédient.';
    } else {
      rules.textContent = '';
    }
    updateCounters();
  }

  function countChecked(sel){
    return document.querySelectorAll(sel+' input[type="checkbox"]:checked').length;
  }

  function computeExtraCost(){
    if(!current) return {extra:0, cost:0};
    const ingSel = countChecked('#ingredients');
    const extra = Math.max(0, ingSel - current.ingIncluded);
    const cost = extra * EXTRA_ING_PRICE;
    return {extra, cost};
  }

  function updateCounters(){
    const ingSel = countChecked('#ingredients');
    const protSel = countChecked('#protéines');
    const topSel  = countChecked('#toppings');

    const ingCounter = document.getElementById('ingCounter');
    const protCounter = document.getElementById('protCounter');
    const topCounter  = document.getElementById('topCounter');
    const {extra, cost} = computeExtraCost();

    if(current){
      ingCounter.textContent =
        `Ingrédients : ${ingSel} (inclus ${current.ingIncluded}` +
        (extra>0 ? ` • +${extra} extra = +${cost.toFixed(2)} €` : '') + ')';
      protCounter.textContent = `Protéines : ${protSel}/${current.protMax} (min ${current.protMin})`;
      topCounter.textContent  = `Toppings : ${topSel}/${current.topMax}`;
    } else {
      ingCounter.textContent = 'Choisis d’abord la taille.';
      protCounter.textContent = '';
      topCounter.textContent = '';
    }

    const ingHint = document.getElementById('ingHint');
    if(ingHint){
      if(current && ingSel < current.ingMin){
        ingHint.style.display = 'block';
        ingHint.textContent = `Choisis encore ${current.ingMin - ingSel} ingrédient(s) pour atteindre le minimum.`;
      } else {
        ingHint.style.display = 'none';
      }
    }

    validateAll();
  }

  function enforceLimits(){
    const ing = Array.from(document.querySelectorAll('#ingredients input[type="checkbox"]'));
    const prot = Array.from(document.querySelectorAll('#protéines input[type="checkbox"]'));
    const top  = Array.from(document.querySelectorAll('#toppings input[type="checkbox"]'));

    const protSel = prot.filter(i=>i.checked).length;
    const topSel  = top.filter(i=>i.checked).length;

    // ✅ Plus AUCUNE limite dure sur les ingrédients (on facture les extras)
    ing.forEach(i=> i.disabled = false);

    // On conserve les limites pour protéines et toppings
    if(current){
      prot.forEach(i=>{ i.disabled = (!i.checked && protSel >= current.protMax); });
      top.forEach(i=>{  i.disabled = (!i.checked && topSel  >= current.topMax);  });
    } else {
      [...prot, ...top].forEach(i=> i.disabled = false);
    }
  }

  // Surbrillance visuelle
  function refreshSelectedClasses(scope){
    const root = scope || document;
    root.querySelectorAll('.ingredients-grid').forEach(grid=>{
      const inputs = grid.querySelectorAll('input');
      inputs.forEach(input=>{
        const label = input.closest('label');
        if(!label) return;
        if(input.type === 'radio'){
          const name = input.name;
          grid.querySelectorAll(`input[type="radio"][name="${name}"]`).forEach(r=>{
            const l = r.closest('label'); if(l) l.classList.toggle('selected', r.checked);
          });
        }else{
          label.classList.toggle('selected', input.checked);
        }
      });
    });
  }

  // Listeners
  document.querySelectorAll('#ingredients input[type="checkbox"], #protéines input[type="checkbox"], #toppings input[type="checkbox"]').forEach(el=>{
    el.addEventListener('change', ()=>{ enforceLimits(); updateCounters(); refreshSelectedClasses(); });
  });
  document.querySelectorAll('input[name="size"]').forEach(el=>{
    el.addEventListener('change', ()=>{ updateRules(); enforceLimits(); });
  });
  document.querySelectorAll('input[name="base"], input[name="sauce"], input[name="smoothie"]').forEach(el=>{
    el.addEventListener('change', ()=>{ validateAll(); refreshSelectedClasses(); });
  });

  function valChecked(name){
    const el = document.querySelector(`input[name="${name}"]:checked`); return el ? el.value : null;
  }
  function valsChecked(name){
    return Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(x=>x.value);
  }

  function basePriceFor(size){
    if(size==='L') return 14.0;
    if(size==='XL') return 17.0;
    return 0;
  }

  function validateAll(){
    const size = currentSize();
    const ingSel = countChecked('#ingredients');
    const protSel = countChecked('#protéines');
    const topSel  = countChecked('#toppings');
    const baseOk = !!document.querySelector('input[name="base"]:checked');
    const sauceOk = !!document.querySelector('input[name="sauce"]:checked');
    const smoothieOk = !!document.querySelector('input[name="smoothie"]:checked');

    let rulesOk = false;
    if(current){
      const okIngr = (ingSel >= current.ingMin);                 // ✅ plus de plafond
      const okProt = (protSel >= current.protMin && protSel <= current.protMax);
      const okTop  = (topSel <= current.topMax);
      rulesOk = okIngr && okProt && okTop;
    }

    const btn = document.getElementById('addToCart');
    btn.disabled = !(rulesOk && baseOk && sauceOk && smoothieOk && size);

    // Affiche le total estimé sur le bouton
    const {cost} = computeExtraCost();
    const total = basePriceFor(size) + cost;
    if (!btn.disabled && size){
      btn.textContent = `Ajouter au panier — ${total.toFixed(2)} €`;
    } else {
      btn.textContent = 'Ajouter au panier';
    }

    const sel = {
      size, base: valChecked('base'), ingredients: valsChecked('ingredients'),
      proteines: valsChecked('proteines'), sauce: valChecked('sauce'), toppings: valsChecked('toppings'),
      smoothie: valChecked('smoothie')
    };
    const review = document.getElementById('review');
    if (review){
      review.textContent =
        (rulesOk && baseOk && sauceOk && smoothieOk && size)
          ? `Prêt : Poké ${size} + Smoothie • Total estimé ${total.toFixed(2)} €`
          : '';
    }
  }

  // Ajouter au panier
  const btnAdd = document.getElementById('addToCart');
  btnAdd.addEventListener('click', ()=>{
    const size = currentSize();
    const basePrice = basePriceFor(size);
    const {extra, cost} = computeExtraCost();
    const total = +(basePrice + cost).toFixed(2);

    const item = {
      type:'menu',
      poke_size: size,
      base: valChecked('base'),
      ingredients: valsChecked('ingredients'),
      proteines: valsChecked('proteines'),
      sauce: valChecked('sauce'),
      toppings: valsChecked('toppings'),
      smoothie: valChecked('smoothie'),
      qty: 1,
      price: total,                               // ✅ prix avec extras
      extras: { extra_ingredients: extra, extra_cost: +cost.toFixed(2) },
      ts: Date.now()
    };

    const cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
    cart.push(item);
    localStorage.setItem(CART_KEY, JSON.stringify(cart));

    updateBadge();
    const badge = document.getElementById('cartBadge');
    if (badge) { badge.classList.add('pulse'); setTimeout(()=> badge.classList.remove('pulse'), 400); }

    btnAdd.disabled = true;
    setTimeout(() => { window.location.href = 'carte.html'; }, 450);
  });

  // init
  updateRules(); enforceLimits(); updateCounters(); validateAll(); updateBadge();
  refreshSelectedClasses();
</script>


</body>
</html>
